FILE=$(shell find './src' -type f -name '*.c' )
INCLUDEOPTS=$(shell awk -F'=' -f ./tool/extract_include.awk conf/build.conf |tr -d '\n' )
INCLUDEOPTS+=-I./src
INCLUDEOPTS+=-I/usr/include
WEBUI_PROTOTYPE_H=src/webui_prototype.h
TMP=src/.tmp_file

all: asset cproto
	rm -f assets/*~
	../kore/kore flavor prod
	../kore/kore build
echo:
	@echo ${INCLUDEOPTS}
cproto:
	touch src/assets.h ;
	echo "" > ${WEBUI_PROTOTYPE_H}
	echo "/* Automatically generated by : make cproto */" > ${TMP}
	cproto ${FILE} ${INCLUDEOPTS} >>  ${TMP}
	/bin/mv -f ${TMP} ${WEBUI_PROTOTYPE_H}

run:
	../kore/kore run

asset src/assetmap.c:
	@echo "Creating assetmap.c" ; ./map_assets > src/assetmap.c

debug: cproto src/assetmap.c
	rm -f assets/*~
	cp -f conf/webui-debug.conf.dist conf/webui.conf
	../kore/kore flavor dev
	../kore/kore build
##	./webui -r -n -f

clean:
	rm -f webui
	../kore/kore clean
#!/bin/bash

